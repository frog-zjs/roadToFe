# js的阻塞特性
## 2015.12.3

JS具有阻塞特性，当浏览器在执行js代码时，不能同时做其它事情，即`<script>`每次出现都会让页面等待脚本的解析和执行（不论JS是内嵌的还是外链的），JS代码执行完成后，才继续渲染页面。
由于，JS的这种阻塞特性，每次遇到`<script>`，页面都必须停下来等待脚本下载并执行，这会停止页面绘制，带来不好的用户体验。所以，有必要减少JS阻塞特性造成的困扰。

- 优化脚本位置
 - HTML4规范中，`<script>`可以放在`<head>`或`<body>`中。你可能习惯性的在`<head>`中放置多个外链JS、CSS，以求优先加载它们。浏览器在继续到<body>之前，不会渲染页面，所以，把JS放在`<head>`中，会导致延迟。为了提高用户体验，新一代浏览器都支持并行下载JS，但是JS下载仍然会阻塞其它资源的下载（如图片）。尽管脚本的下载过程并不会相互影响，但页面仍然必须等待所有JS下载并执行完成才能继续。显然，有`<script>`应该尽可能放到<body>的底部，以减少对页面下载的影响。
 - **注意**：CSS文件本身是并行下载，不会阻塞页面的其他进程。但是，如果把一段内嵌脚本放在引用外链CSS的<link>之后会导致页面阻塞去等待CSS的下载。为了确保内嵌脚本在执行时能够获得正确的样式信息，最好不要把内嵌脚本放在CSS的`<link>`之后。
- 减少外链脚本数量以改善性能
 - 原因很简单，额外的HTTP请求会带来额外的开销，所以减少页面中外链脚本的数量，有助于改善性能。
- 使用无阻塞下载JS方法
 - 在页面加载完成后才加载JS，即在window.load事件触发后再下载脚本。
- 使用`<script>`的defer属性（仅IE和Firefox3.5以上）
 - defer属性指明本元素所含的脚本不会修改DOM，因此代码能安全的延迟执行。defer属性的`<script>`，对应的JS文件将在页面解析到`<script>`时开始下载，但并不会执行，直到DOM加载完成，即onload事件触发前被调用。当一个带有defer属性的JS文件下载时，他不会阻塞浏览器的其它进程，因此这类文件可以与页面中的其他资源并行下载。